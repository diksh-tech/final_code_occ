import React, { useState } from "react";
import ChatPage from "./components/ChatPage";
import "./App.css";

export default function App() {
  const [query, setQuery] = useState("");

  return (
    <div className="app-container">
      {/* Sidebar */}
      <div className="sidebar">
        <div className="sidebar-header">
          <div className="logo-container">
            <div className="logo-placeholder">
              ‚úàÔ∏è
            </div>
            <h1>FlightOps Smart Agent</h1>
          </div>
        </div>
        
        <div className="sidebar-content">
          <div className="sidebar-section">
            <h3>Quick Actions</h3>
            <button className="sidebar-btn">Flight Delays</button>
            <button className="sidebar-btn">Fuel Reports</button>
            <button className="sidebar-btn">Aircraft Info</button>
            <button className="sidebar-btn">Passenger Data</button>
          </div>
          
          <div className="sidebar-section">
            <h3>Recent Queries</h3>
            <div className="recent-query">"Why was 6E215 delayed?"</div>
            <div className="recent-query">"Fuel consumption for AI202"</div>
            <div className="recent-query">"Passenger count for UK945"</div>
          </div>

          <div className="indigo-gif-placeholder">
            <div className="gif-container">
              <div className="animated-plane">‚úàÔ∏è</div>
              <p>Flight Operations</p>
              <p>Live Monitoring</p>
            </div>
          </div>
        </div>
      </div>

      {/* Main Content */}
      <div className="main-content">
        <div className="header">
          <div className="flex items-center justify-center mt-6 space-x-3">
            <img src="/src/assets/indigo-logo.png" alt="logo" className="h-10" />
            <h1 className="text-2xl font-bold text-indigo-700">
              FlightOps Smart Agent ‚úàÔ∏è
            </h1>
          </div>
        </div>
        <ChatPage />
      </div>
    </div>
  );
}
################################
import React, { useState, useRef, useEffect } from "react";
import MessageBubble from "./MessageBubble";

const AG_AGENT_ENDPOINT = import.meta.env.VITE_AGENT_ENDPOINT || "http://localhost:8001/agent";

export default function ChatPage() {
  const [messages, setMessages] = useState([
    {
      role: "assistant",
      content: "Hello! üëã I'm your FlightOps Agent. Ask me anything about flight operations ‚Äî delays, fuel, passengers, aircraft details, etc.",
      timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    },
  ]);
  const [input, setInput] = useState("");
  const [loading, setLoading] = useState(false);
  const messagesEndRef = useRef(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  async function sendMessage() {
    if (!input.trim()) return;

    const userMessage = { 
      role: "user", 
      content: input,
      timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };
    setMessages((prev) => [...prev, userMessage]);
    setLoading(true);
    setInput("");

    const body = {
      thread_id: "thread-" + Date.now(),
      run_id: "run-" + Date.now(),
      messages: [userMessage],
    };

    try {
      const resp = await fetch(AG_AGENT_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });

      if (!resp.ok) {
        const errTxt = await resp.text();
        throw new Error(errTxt);
      }

      const reader = resp.body.getReader();
      const decoder = new TextDecoder();
      let buf = "";

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        buf += decoder.decode(value, { stream: true });

        let idx;
        while ((idx = buf.indexOf("\n\n")) !== -1) {
          const chunk = buf.slice(0, idx).trim();
          buf = buf.slice(idx + 2);
          const lines = chunk.split("\n");

          for (const line of lines) {
            if (line.startsWith("data: ")) {
              const payload = line.slice(6).trim();
              if (!payload) continue;

              try {
                const event = JSON.parse(payload);
                handleEvent(event);
              } catch (err) {
                console.warn("Bad SSE line:", payload);
              }
            }
          }
        }
      }
    } catch (err) {
      setMessages((prev) => [
        ...prev,
        { 
          role: "assistant", 
          content: "‚ö†Ô∏è Error: " + err.message,
          timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        },
      ]);
    } finally {
      setLoading(false);
    }
  }

  function handleEvent(event) {
    const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    switch (event.type) {
      case "TEXT_MESSAGE_CONTENT":
        if (event.message?.content) {
          // assistant final message
          setMessages((prev) => [
            ...prev,
            { 
              role: "assistant", 
              content: event.message.content,
              timestamp: timestamp
            },
          ]);
        } else if (event.content) {
          // status update - you can remove this if you don't want intermediate messages
          setMessages((prev) => [
            ...prev,
            { 
              role: "assistant", 
              content: event.content,
              timestamp: timestamp
            },
          ]);
        }
        break;
      case "TOOL_CALL_RESULT":
        // Skip displaying tool results
        break;
      case "RUN_FINISHED":
        // Skip displaying run finished
        break;
      default:
        // ignore other technical events
        break;
    }
  }

  return (
    <div className="chat-container">
      <div className="messages-container">
        {messages.map((msg, idx) => (
          <MessageBubble 
            key={idx} 
            role={msg.role} 
            content={msg.content} 
            timestamp={msg.timestamp}
          />
        ))}
        {loading && (
          <div className="loading-message">
            <div className="loading-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <div className="loading-timestamp">
              {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </div>

      <div className="input-container">
        <input
          type="text"
          className="message-input"
          placeholder="Ask about a flight, e.g. 'Why was 6E215 delayed on June 23, 2024?'"
          value={input}
          onChange={(e) => setInput(e.target.value)}
          onKeyDown={(e) => e.key === "Enter" && sendMessage()}
        />
        <button
          onClick={sendMessage}
          className="send-button"
          disabled={loading}
        >
          Send
        </button>
      </div>
    </div>
  );
}
###########################
import React from "react";

export default function MessageBubble({ role, content, timestamp }) {
  return (
    <div className={`message ${role}-message`}>
      <div className="message-content">
        <div className="message-text">{content}</div>
        <div className="message-timestamp">{timestamp}</div>
      </div>
    </div>
  );
}
###############################
/* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  height: 100vh;
  overflow: hidden;
}

.app-container {
  display: flex;
  height: 100vh;
}

/* Sidebar Styles */
.sidebar {
  width: 300px;
  background: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
  color: white;
  display: flex;
  flex-direction: column;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
}

.sidebar-header {
  padding: 2rem 1.5rem 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.logo-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.logo-placeholder {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #818cf8, #4f46e5);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  margin-bottom: 1rem;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.sidebar-header h1 {
  font-size: 1.1rem;
  font-weight: 600;
  color: #e0e7ff;
}

.sidebar-content {
  flex: 1;
  padding: 1.5rem;
  overflow-y: auto;
}

.sidebar-section {
  margin-bottom: 2rem;
}

.sidebar-section h3 {
  font-size: 0.9rem;
  font-weight: 600;
  color: #a5b4fc;
  margin-bottom: 1rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sidebar-btn {
  width: 100%;
  padding: 0.75rem 1rem;
  margin-bottom: 0.5rem;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  color: white;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  font-size: 0.9rem;
}

.sidebar-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateX(4px);
}

.recent-query {
  padding: 0.75rem 1rem;
  margin-bottom: 0.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 6px;
  font-size: 0.85rem;
  color: #c7d2fe;
  border-left: 3px solid #818cf8;
}

/* Indigo GIF Placeholder */
.indigo-gif-placeholder {
  margin-top: auto;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.gif-container {
  text-align: center;
}

.animated-plane {
  font-size: 3rem;
  margin-bottom: 1rem;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
}

.gif-container p {
  color: #a5b4fc;
  font-size: 0.9rem;
  margin-bottom: 0.25rem;
}

/* Main Content */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: #f8fafc;
  overflow: hidden;
}

.header {
  background: white;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  padding: 0.5rem 0;
}

/* Scrollbar Styling */
.sidebar-content::-webkit-scrollbar {
  width: 4px;
}

.sidebar-content::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.1);
}

.sidebar-content::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.3);
  border-radius: 2px;
}

.sidebar-content::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.5);
}

/* Responsive Design */
@media (max-width: 768px) {
  .app-container {
    flex-direction: column;
  }
  
  .sidebar {
    width: 100%;
    height: auto;
    max-height: 200px;
  }
  
  .sidebar-content {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
  }
  
  .sidebar-section {
    flex-shrink: 0;
    margin-bottom: 0;
  }
  
  .indigo-gif-placeholder {
    display: none;
  }
}
###############################
/* Chat Container */
.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: white;
  margin: 1rem;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.messages-container {
  flex: 1;
  padding: 1.5rem;
  overflow-y: auto;
  background: #f8fafc;
}

/* Message Bubbles */
.message {
  margin-bottom: 1.5rem;
  display: flex;
}

.user-message {
  justify-content: flex-end;
}

.user-message .message-content {
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  border-bottom-right-radius: 4px;
}

.assistant-message .message-content {
  background: white;
  color: #374151;
  border: 1px solid #e5e7eb;
  border-bottom-left-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.message-content {
  max-width: 70%;
  padding: 1rem 1.25rem;
  border-radius: 18px;
  position: relative;
}

.message-text {
  line-height: 1.5;
  margin-bottom: 0.5rem;
}

.message-timestamp {
  font-size: 0.75rem;
  opacity: 0.7;
  margin-top: 0.5rem;
}

.user-message .message-timestamp {
  text-align: right;
  color: rgba(255, 255, 255, 0.8);
}

.assistant-message .message-timestamp {
  text-align: left;
  color: #6b7280;
}

/* Loading Animation */
.loading-message {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  margin-bottom: 1.5rem;
}

.loading-dots {
  display: flex;
  gap: 0.25rem;
  padding: 1rem 1.25rem;
  background: white;
  border-radius: 18px;
  border: 1px solid #e5e7eb;
}

.loading-dots span {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #9ca3af;
  animation: bounce 1.4s infinite ease-in-out;
}

.loading-dots span:nth-child(1) { animation-delay: -0.32s; }
.loading-dots span:nth-child(2) { animation-delay: -0.16s; }

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
  40% { transform: scale(1); opacity: 1; }
}

.loading-timestamp {
  font-size: 0.75rem;
  color: #6b7280;
  margin-top: 0.5rem;
  margin-left: 1.25rem;
}

/* Input Container */
.input-container {
  display: flex;
  gap: 0.75rem;
  padding: 1.5rem;
  background: white;
  border-top: 1px solid #e5e7eb;
}

.message-input {
  flex: 1;
  padding: 0.75rem 1rem;
  border: 1px solid #d1d5db;
  border-radius: 12px;
  font-size: 0.95rem;
  outline: none;
  transition: all 0.2s;
}

.message-input:focus {
  border-color: #4f46e5;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.send-button {
  padding: 0.75rem 1.5rem;
  background: linear-gradient(135deg, #4f46e5, #7c3aed);
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.send-button:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
}

.send-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* Responsive */
@media (max-width: 768px) {
  .message-content {
    max-width: 85%;
  }
  
  .input-container {
    padding: 1rem;
  }
}
